<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Bike: XSR</title>
    <style>
        :root {
            --bg-color: #0d0d0d;
            --card-bg: #161616;
            --text-color: #e0e0e0;
            --accent-color: #D000FF; 
            --success: #00ff88;
            --danger: #ff4d4d;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg-color); color: var(--text-color); display: flex; justify-content: center; padding: 20px; margin: 0; }
        .container { width: 100%; max-width: 600px; background: var(--card-bg); padding: 25px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); border: 1px solid #222; }
        
        /* Dashboard & Stats */
        .dashboard { background: #222; padding: 20px; border-radius: 15px; margin-bottom: 25px; border-bottom: 3px solid var(--accent-color); }
        .main-balance { font-size: 2em; font-weight: bold; color: #fff; margin-bottom: 10px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 0.85em; }
        .selisih-plus { color: var(--success); }
        .selisih-minus { color: var(--danger); }
        .progress-container { background: #333; height: 10px; border-radius: 5px; overflow: hidden; margin: 15px 0 5px 0; }
        .progress-bar { background: var(--accent-color); height: 100%; width: 0%; transition: 0.6s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 0 10px var(--accent-color); }

        /* Input Form */
        .input-group { background: #1a1a1a; padding: 15px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #333; }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        input { background: #000; border: 1px solid #444; color: #fff; padding: 12px; border-radius: 8px; outline: none; width: 100%; font-size: 0.9em; }
        .btn-row { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 0.9em; }
        .btn-in { background: var(--success); color: #000; }
        .btn-out { background: var(--danger); color: #fff; }

        /* Checklist Table (PERBAIKAN UTAMA) */
        h3 { font-size: 0.95em; text-transform: uppercase; color: var(--accent-color); margin-bottom: 15px; letter-spacing: 1px; }
        .target-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .target-table tr { border-bottom: 1px solid #222; transition: 0.3s; }
        .target-table tr.checked { opacity: 0.3; }
        .target-table td { padding: 12px 5px; vertical-align: middle; }
        .col-check { width: 40px; text-align: center; }
        .col-name { text-align: left; font-size: 0.95em; }
        .col-price { text-align: right; font-weight: bold; font-size: 0.95em; white-space: nowrap; }
        
        input[type="checkbox"] { 
            width: 20px; height: 20px; cursor: pointer; accent-color: var(--accent-color); 
        }

        /* History Tables */
        .history-section { margin-top: 20px; border-top: 1px solid #333; padding-top: 20px; }
        .hist-table { width: 100%; font-size: 0.85em; border-collapse: collapse; margin-bottom: 20px; }
        .hist-table th { text-align: left; color: #666; padding-bottom: 8px; font-weight: normal; }
        .hist-table td { padding: 8px 0; border-bottom: 1px solid #1a1a1a; }
        .txt-success { color: var(--success); }
        .txt-danger { color: var(--danger); }
    </style>
</head>
<body>

<div class="container">
    <div class="dashboard">
        <div style="font-size: 0.8em; opacity: 0.6; margin-bottom: 5px;">SALDO BUDGET SAAT INI</div>
        <div class="main-balance" id="wallet-val">Rp0</div>
        <div class="stats-grid">
            <div>
                <div style="opacity: 0.5; margin-bottom: 3px;">Sisa Belanja:</div>
                <div id="target-val" style="font-weight: bold;">Rp0</div>
            </div>
            <div>
                <div style="opacity: 0.5; margin-bottom: 3px;">Status Selisih:</div>
                <div id="selisih-val" style="font-weight: bold;">Rp0</div>
            </div>
        </div>
        <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>
        <div id="progress-percent" style="font-size: 0.7em; color: var(--accent-color); text-align: right;">0%</div>
    </div>

    <div class="input-group">
        <div class="input-row">
            <input type="text" id="desc-input" placeholder="Keterangan (Gaji, Jajan...)">
            <input type="number" id="amount-input" placeholder="Nominal Rp">
        </div>
        <div class="btn-row">
            <button class="btn-in" onclick="addTransaction('IN')">+ PEMASUKAN</button>
            <button class="btn-out" onclick="addTransaction('OUT')">- PENGELUARAN</button>
        </div>
    </div>

    <h3>Target Belanja Motor</h3>
    <table class="target-table">
        <tbody id="checklist-body">
            </tbody>
    </table>

    <div class="history-section">
        <h3>Riwayat Pemasukan</h3>
        <table class="hist-table">
            <thead><tr><th>Keterangan</th><th style="text-align: right;">Jumlah</th></tr></thead>
            <tbody id="table-in"></tbody>
        </table>

        <h3>Riwayat Pengeluaran</h3>
        <table class="hist-table">
            <thead><tr><th>Keterangan</th><th style="text-align: right;">Jumlah</th></tr></thead>
            <tbody id="table-out"></tbody>
        </table>
    </div>
</div>

<script>
    const items = [
        { name: "Helm KYT R2R", price: 2100000 },
        { name: "Action Cam", price: 1000000 },
        { name: "Intercom Budget/Ejeas", price: 350000 },
        { name: "Stang Clubman", price: 132000 },
        { name: "Spion Bar End", price: 100000 },
        { name: "Tail Tidy", price: 100000 },
        { name: "Mudguard", price: 130000 },
        { name: "Phone Holder GUB", price: 50000 },
        { name: "Radiator Guard", price: 150000 }
    ];

    let history = JSON.parse(localStorage.getItem('xsrHistory')) || [];
    let checkedStates = JSON.parse(localStorage.getItem('xsrChecked')) || {};

    function formatIDR(n) { return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(n); }

    function addTransaction(type) {
        const descInput = document.getElementById('desc-input');
        const amountInput = document.getElementById('amount-input');
        const desc = descInput.value;
        const amount = parseFloat(amountInput.value);

        if (!desc || isNaN(amount)) { alert("Mohon isi keterangan dan nominal!"); return; }

        history.push({ desc, amount, type, id: Date.now() });
        localStorage.setItem('xsrHistory', JSON.stringify(history));
        
        descInput.value = '';
        amountInput.value = '';
        render();
    }

    function toggle(i) {
        checkedStates[i] = !checkedStates[i];
        localStorage.setItem('xsrChecked', JSON.stringify(checkedStates));
        render();
    }

    function render() {
        const checklistBody = document.getElementById('checklist-body');
        const tIn = document.getElementById('table-in');
        const tOut = document.getElementById('table-out');
        const progBar = document.getElementById('progress-bar');
        const progText = document.getElementById('progress-percent');
        
        let wallet = 0;
        let remainingTarget = 0;
        let spentTarget = 0;
        const totalPlan = items.reduce((a, b) => a + b.price, 0);

        // Render History & Calculate Wallet
        tIn.innerHTML = ''; tOut.innerHTML = '';
        history.slice().reverse().forEach(h => {
            const row = `<tr><td>${h.desc}</td><td style="text-align: right;" class="${h.type=='IN'?'txt-success':'txt-danger'}">${h.type=='IN'?'+':'-'} ${formatIDR(h.amount)}</td></tr>`;
            if (h.type === 'IN') { wallet += h.amount; tIn.innerHTML += row; }
            else { wallet -= h.amount; tOut.innerHTML += row; }
        });

        // Render Checklist
        checklistBody.innerHTML = '';
        items.forEach((item, i) => {
            const isChecked = checkedStates[i];
            if (!isChecked) remainingTarget += item.price;
            else spentTarget += item.price;

            checklistBody.innerHTML += `
                <tr class="${isChecked ? 'checked' : ''}">
                    <td class="col-check"><input type="checkbox" ${isChecked ? 'checked' : ''} onchange="toggle(${i})"></td>
                    <td class="col-name">${item.name}</td>
                    <td class="col-price">${formatIDR(item.price)}</td>
                </tr>`;
        });

        // Dashboard Updates
        document.getElementById('wallet-val').innerText = formatIDR(wallet);
        document.getElementById('target-val').innerText = formatIDR(remainingTarget);
        
        const selisih = wallet - remainingTarget;
        const sEl = document.getElementById('selisih-val');
        sEl.innerText = formatIDR(selisih);
        sEl.className = selisih >= 0 ? 'selisih-plus' : 'selisih-minus';
        
        const percent = Math.round((spentTarget / totalPlan) * 100);
        progBar.style.width = percent + '%';
        progText.innerText = percent + '% Terpenuhi';
    }

    render();
</script>
</body>
</html>